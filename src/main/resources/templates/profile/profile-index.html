<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="/partials/partials :: head('Profile')"></head>
<body>

<div id="wrapper">
  <nav th:replace="/partials/partials :: nav"></nav>
  <header th:replace="/partials/partials :: header('Profile')"></header>

  <main class="container">
    <h1>THIS IS YOUR PROFILE PAGE</h1>
    <div th:each="task : ${tasks}">
      <ul>
        <li th:text="${task.title}"></li>
        <li th:text="${task.description}"></li>
        <li th:text="${task.dateCreated}"></li>
        <li th:text="${task.dateScheduled}"></li>
        <li th:text="${task.complete}"></li>
        <li th:text="${task.category.title}"></li>
      </ul>
      <form th:method="POST" th:action="@{|/task/delete/${task.id}|}" th:object="${task}" th:data-task-id="${task.id}" th:data-task-title="${task.title}">
        <button type="button" class="btn btn-dark" onclick="showDeleteConfirmationModal(this)">Delete Task</button>
      </form>
      <!--            <a th:href="@{/posts/{id}(id=${post.id})}">View Details</a>-->
<!--      <a th:href="@{|/posts/${post.id}|}">View Details</a>-->
    </div>
  </main>

<!--  DELETE CONFIRMATION MODAL -->
  <div class="modal fade" id="deleteConfirmationModal" tabindex="-1" role="dialog" aria-labelledby="deleteConfirmationModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="deleteConfirmationModalLabel">Confirm Delete</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          Are you sure you want to delete this task: <span id="taskTitle"></span>?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-danger" id="confirmDelete">Delete</button>
        </div>
      </div>
    </div>
  </div>
<!--  DELETE CONFIRMATION MODAL -->


  <footer th:replace="/partials/partials :: footer"></footer>
</div>


<th:block th:replace="partials/partials :: scripts"></th:block>

<script>
  /// Function to show the delete confirmation modal
  function showDeleteConfirmationModal(button) {
    let modal = document.querySelector('#deleteConfirmationModal');
    let taskTitleSpan = document.querySelector('#taskTitle');
    let form = button.closest('form');

    // Extract the task title and ID from the form's data attributes
    let taskTitle = form.getAttribute('data-task-title');
    let taskId = form.getAttribute('data-task-id');

    // Set the task title in the modal
    taskTitleSpan.innerText = taskTitle;

    modal.classList.add('show');
    modal.style.display = 'block';

    // Attach a click event listener to the Cancel button
    const cancelButton = document.querySelector('#deleteConfirmationModal button.btn-secondary');
    cancelButton.addEventListener('click', function() {
      modal.style.display = 'none';
    });

    // Attach a click event listener to the Delete button
    const confirmDeleteButton = document.querySelector('#confirmDelete');
    confirmDeleteButton.addEventListener('click', function() {
      // Submit the form associated with the clicked button
      form.submit();
    });
  }




</script>

</body>
</html>